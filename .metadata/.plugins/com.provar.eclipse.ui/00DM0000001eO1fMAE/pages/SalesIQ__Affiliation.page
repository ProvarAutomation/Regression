<apex:page sidebar="false"  id="page1"  controller="SalesIQ.affiliationCntrl" action="{!populateAccounts}" tabstyle="Affiliation__tab">

    
    <apex:includeScript value="{!URLFOR($Resource.SalesIQ__DynaTree, 'jquery/jquery.js' )}" />
    <apex:includeScript value="{!URLFOR($Resource.SalesIQ__DynaTree, 'jquery/jquery-ui.custom.js' )}" />
    <apex:includeScript value="{!URLFOR($Resource.SalesIQ__DynaTree, 'jquery/jquery.cookie.js' )}" />
    <apex:includeScript value="{!URLFOR($Resource.SalesIQ__DynaTree, 'src/jquery.dynatree.js' )}" />
    <apex:stylesheet value="{!URLFOR($Resource.SalesIQ__jstree, '/jstree/dist/themes/default/style.min.css')}"/> 
    <apex:stylesheet value="{!URLFOR($Resource.SalesIQ__DynaTree, 'src/skin/ui.dynatree.css')}" />
    <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" />
    <apex:includescript value="//cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js" />
    <apex:stylesheet value="//cdn.datatables.net/1.10.4/css/jquery.dataTables.css" />
    
    
    <apex:includescript value="//cdn.datatables.net/plug-ins/1.10.7/api/fnDisplayRow.js" />
    <!-- <apex:includeScript value="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.8/js/jquery.tablesorter.min.js" />
    <apex:stylesheet value="//cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.8/css/theme.blue.css" />  -->
    <script src="{!$Resource.jqueryfixheadertable}"></script>
<apex:form id="form1" > 

<head>
<style>


  body button, body .x-btn, body .btn, body .btnDisabled, body .btnCancel, body .menuButton .menuButtonButton {
    padding: 2px 6px ;
} 

.dynatree-container{
    border:0px !important;
    }
    
.box-main{
    width:100%;
    margin:30px auto;             
}
.box-main-popup{
    width:100%;
    margin:-2px auto;             
}
.box-content{
    background-color:#f7f7f7;
    padding:5px;
    border:1px solid #cccccc;
}
.box-content-popup{
    background-color:#fff;
    padding:5px;
    border:1px solid #cccccc;
}
td{
    font-size:11px !important;
    line-height:16px !important;
}
.box-top{
    border-top:3px solid #00335B;
    -moz-border-top:3px solid #00335B;
    -webkit-border-top:3px solid #00335B;
    border-top-left-radius:10px;
    border-top-right-radius:10px;
    -moz-border-top-left-radius:10px;
    -moz-border-top-right-radius:10px;
    -webkit-border-top-left-radius:10px;
    -webkit-border-top-right-radius:10px;
    background-color:#F8F8F8;
    border-left:1px solid #cccccc;
    border-right:1px solid #cccccc;
    color:#000;
    padding:12px 0 0 15px;
    font-weight:600;
    font-size:18px;
    height:30px;
} 
.tablecontent{
    vertical-align:top;
    height:450px;
    background-color:#fff;
    margin-left:290px;
    border:1px solid #989898;
    font-size:12px;
    overflow-y:auto;

}
.box-top-div1{
    
    font-weight:800;
    font-size:16px;
    float:left;
    text-align:left;
    height:25px;
    color:#666 !important;
    
}
.box-top-div2{
    /*width:50%;*/
    font-weight:600;
    font-size:12px;
    float:left;
    text-align:center;
    height:25px;
    
}
.box-top-div3{
    width:5%;
    font-weight:600;
    font-size:14px;
    float:left;
    height:25px;
}
.box-top-div4{
    width:25%;
    font-weight:600;
    font-size:13px;
    float:left;
    height:25px;
    
}
.box-top-div5{
    width:30%;
    font-size:13px;
    text-align:right;
    float:right;
    height:25px;
    padding-right: 10px;
}
.box-top-div5-1{
    width:23%;
    font-size:13px;
    text-align:right;
    float:right;
    height:25px;
    padding-right: 10px;
}
.searchbutton1{
    width:80px;
    height:21px;
    font-size:11px !important;
    margin-left:-80px !important;
    border:1px solid #ccc !important;
    background-color:#f0f0f0 !important;
    color:#000;
    border-bottom-right-radius:5px;
    border-top-right-radius:5px;
    z-index:1;
}
.searchbutton21{
    width:80px;
    height:21px;

    margin-left:10px !important;
    border:1px solid #3fa9f5 !important;
    background-color:#f0f0f0 !important;
 
    border-bottom-right-radius:3px;
    border-top-right-radius:3px;
    z-index:1;
}
.searchtxt1{
    border: 1px solid #ccc;
    border-radius: 3px;
    height: 18px;
   /* margin-left: 100px; */
    padding-top: 0px;
    width: 200px;
}
.button11{
   padding:1px 10px !important;
   font-size:11px !important;
   font-weight:bold !important;
   height:22px !important;
   text-align:right;
    }
.tree1{
    width:275px;
    vertical-align:top;
    float:left;
    height:450px;
    background-color:#fff;
    border:1px solid #989898;
}

#jstree{
    overflow: auto;
    width: 275px;
    height: 420px;
}
.clear{
    clear:both;
}

th{
    color:#fff !important;
    background-color:#277AA8 !important;
    font-size:11.5px !important;
    line-height:20px;
}

.table_header_tree{
    color:#fff !important;
    background-color:#277AA8 !important;
    font-size:12px !important;
    font-weight:bold;
    line-height:30px !important;
    padding-left:12px;
    -webkit-overflow-scrolling: touch;
    width:96%;
}
.table_header_main{
    color:#404041 !important;
    background-color:#277AA8 !important;
    font-size:16px !important;
    text-align:center;
    line-height:30px !important;
}
td{
    line-height:20px ;
}
.even { 
   /* background-color: White !important;*/
 
}
.odd {
   /* background-color: #e6f5fc !important; */
}
.number{
   
    text-align: left;
}
.text{
    text-align:center;
}
.table{
    border:1px solid ;
    line-height:25px !important;
}

.pure-table{border-collapse:collapse;border-spacing:0;empty-cells:show; border:1px solid #cbcbcb}
.pure-table caption{color:#000;font:italic 85%/1 arial,sans-serif;padding:1em 0;text-align:center}
.pure-table td,.pure-table th{border-left:1px solid #cbcbcb; border-width:0 0 0 1px; font-size:inherit; line-height:20px; margin:0; overflow:visible; padding:.25em .50em  }
.pure-table td:first-child,.pure-table th:first-child{border-left-width:0}
.pure-table thead{background:#e0e0e0;color:#000;text-align:left;vertical-align:bottom}
.pure-table td{background-color:transparent}
.pure-table-odd td{background-color:#e6f5fc}
.pure-table-striped tr:nth-child(2n-1) td{background-color:#f2f2f2}
.pure-table-bordered td{border-bottom:1px solid #cbcbcb}
.pure-table-bordered tbody>tr:last-child td,.pure-table-horizontal tbody>tr:last-child td{border-bottom-width:0}
.pure-table-horizontal td,.pure-table-horizontal th{border-width:0 0 1px;border-bottom:1px solid #cbcbcb}
.pure-table-horizontal tbody>tr:last-child td{border-bottom-width:0}

span.dynatree-node a{
    font-size :11px !important ;

}
.wrapper1 .tooltip {
    color: black;
    display: block;
    left: 92px;
    margin-bottom: 15px; 
    opacity: 0;
    padding: 20px;
    pointer-events: none;
    position: absolute;
    -webkit-transform: translateY(10px);
    -moz-transform: translateY(10px);
    -ms-transform: translateY(10px);
    -o-transform: translateY(10px);
    transform: translateY(10px);
    -webkit-transition: all .25s ease-out;
    -moz-transition: all .25s ease-out;
    -ms-transition: all .25s ease-out;
    -o-transition: all .25s ease-out;
    transition: all .25s ease-out;
    -webkit-box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.28);
    -moz-box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.28);
    -ms-box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.28);
    -o-box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.28);
    box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.28);
}
.link{
    
    text-decoration:underline;
    color:#0b71be !important;
    font-weight:normal !important;
    padding-right:10px;
    }
.notes{
    height:25px;
    font-weight:bold;
    text-align:right;
   font-size:12px;
    width:105px !important;
    float:left;
    position:relative;
}
.notes-text-box{
    float:left;
    border:1px solid #333;
    width:180px !important;
    height:22px;
    padding-left: 5px;
}
.notes-text-box1{
    float:left;
    border:1px solid #333;
    width:187px !important;
    height:25px;
    padding-left: 5px;
}
.notes-text-box3{
    float:left;
    border:1px solid #333;
    width:75px !important;
    height:25px;
    padding-left: 5px;
}
.notes1{
   
    font-weight:bold;
    text-align:right;
    width:150px;
    padding-left:10px;
    font-size:12px;
    float:left;
    position:relative;
}
.notes-textbox{
    float:left;
    border:1px solid #333;
    width:350px;
    height:50px;
    padding-left:5px;
    position:relative;
    /*margin-left:20px;*/
    margin-bottom:20px;
    
}
.popup_top_info{
            background-color: #e3e3e3;
            border-bottom: 1px solid #000;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            font-size: 18px;
            margin-right: 0;
            margin-top: 0;
        padding: 10px 567px 9px 5px !important;
        }

  .Popup2
    {   
        background-color:white;         
        text-align:centre;
        z-index: 0;
        left: 50%;
        position: absolute;
        width: 600px;
       /* height:360px;*/
        margin-left: -250px;
        valign:top;
        border-style: solid;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        border-width: 3px 1px 1px;
        -moz-box-shadow: 0px 0px 10px rgba(0, 0, 0, 1);
        -webkit-box-shadow: 0px 0px 10px rgba(0, 0, 0, 1);
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 1);
        font-size:12px;
        top:20%;
    } 
.Popup_Terr
    {        
    
        background-color: white;
        border: #000 1px solid;
        text-align: center;
        z-index: 0;
        left: 50%;
        position: absolute;
        width: 600px;
        height: 250px;
        margin-left: -450px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        valign: top;
        -moz-box-shadow: 0px 0px 10px rgba(0, 0, 0, 1);
        -webkit-box-shadow: 0px 0px 10px rgba(0, 0, 0, 1);
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 1);
        font-size: 14px;
        top: 20%;
    
    }    
 .popupBackground{
        background-color:black;
        opacity: 0.20;
        filter: alpha(opacity = 20);
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 0;
    }
    
    .popupBackgroundworkbench{
        background-color:black;
        opacity: 0.20;
        filter: alpha(opacity = 20);
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 0;
    }
.customPopup {
  
    padding: 10px;
    left: 50%;
    margin-left: -376px;
    position: absolute;
     z-index: 2000;
    width: 924px;
    top: 20%;
    }
.customPopupSc {
    background-color: white;
    border-style: solid;
    border: #003f77 1px solid;
  
    border-top: #003f77 2px solid;
    padding: 10px;
    left: 50%;
    margin-left: -350px;
    position: absolute;
    z-index: 2222;
    width: 700px;
    top: 20%;
    }   
.customPopup_OK {
    background-color: white;
    border-style: solid;
    border: #003f77 1px solid;
 
    border-top: #003f77 2px solid;
    padding: 20px;
    height: 200px;
    left: 50%;
    margin-left: -200px;
    position: absolute;
    z-index: 2000;
    width: 450px;
    height: 400px;
    top: 20%;
    }
.pagination{
    width:750px;
    text-align:center;
    height:30px;
    padding:7px 0px;
    margin-left:25%;
    }
    
.page-buttons{
   font-size:12px !important;
    font-weight:bold !important;
    height:22px !important;
    text-align:right;
    }  
}
             
br{
line-height:10px !important;
}

.selectedDataRow {
background-color:#DCEEF3;
font-Weight:bold;
}
.pbHeader
{
margin-bottom:-72px !important;
}

.headerRow1{
    color:#fff !important;
    background-color:#277AA8 !important;
    font-size:11.5px !important;
    line-height:20px;
} 
.table-side-header{
    margin-left:20px;
    text-align:left;
    font-weight:bold;
    }
.headerCSS1
{
    color:#fff !important;
}
</style>
<script>  
                                  
function searchgrp(obj){
if(obj.length>2)
search();
}
$(document).ready(function(){
     var j$=jQuery.noConflict(); 
    j$("[id$=delinkButtonId]").attr("disabled", "disabled").removeClass("btn").addClass("btnDisabled");
    
}); 
function clickElem(elem){
//alert();
        alert($(elem).closest("tr")[0].rowIndex);
    }           
function searchTable(searchText)
{
    /*get Table using its Id */   
    var j$=jQuery.noConflict();                        
    var table = j$('table[id$=thePbTable_1]');
    j$(table).find('tr').each(function(index, row){
        var allCells = jQuery(row).find("td:nth-child(2),td:nth-child(1)");
        if(allCells.length > 0)
        {
            var found = false;
            allCells.each(function(index, td)
            {
                var regExp = new RegExp(searchText, 'i');
                if(regExp.test(j$(td).text())||regExp.test(j$(td).find("input").val()))
                {
                    found = true;
                    return false;
                }
            });
            if(found == true)j$(row).show();else j$(row).hide();
        }
    });
}       
   
  
function updateRowColor(row) 
{                               
    j$('tr').removeClass('selectedDataRow');
    j$(row).addClass('selectedDataRow');
}
function processLinkButton()
{

    var inputChkBox =$( "input:checked" ).length;
    //alert('value of inputChkBx'+inputChkBox);
    if(inputChkBox>0)
    {
        processLinkFun();
        return true;
    }
    else
    {
        //alert('Please select a Dealer.');
        linkError();
        return false;
    }
}

function processDelinkButton()
{

    var inputChkBox =$( "input:checked" ).length;
    //alert('value of inputChkBx'+inputChkBox);
    if(inputChkBox>0)
    {
        processDelinkFun();
        return true;
    }
    else
    {
        //alert('Please select a Dealer.');
        linkError();
        return false;
        
    }
}

function assignFunction()
{
    //alert('--inside assign--');
    var chkBoxes=$( "[type=checkbox]" ).length;
    //alert('--length---'+chkBoxes);
    if(chkBoxes>0)
    {
        $("[id$=delinkButtonId]").removeAttr("disabled").removeClass("btnDisabled").addClass("btn");
        //alert('enabled');
    }
    else
    {
        $("[id$=delinkButtonId]").attr("disabled", "disabled").removeClass("btn").addClass("btnDisabled");
        //alert('disabled');
    }
    clearSearch();
}

//function clearSearch()
//{
  //  $("[id$=searchdata]").val('');
    //alert('cleared');
    //var $j = jQuery.noConflict();
    //console.log('inside search');   
  //  var table=$j("table[id$='thePbTable_1']");
//    $j("table[id$='thePbTable_1']").dataTable();
  //  console.log(table);
//}
</script>
  
 
</head>
    <!-- ------------------------------------------------------------------- VF page ------------------------------------------------------ -->
    
 <body class="claro">
<!--<apex:outputpanel id="scriptPanel">-->
   <script type="text/javascript">
                                   $.noConflict();
                                    $(function(){
                                        // Attach the dynatree widget to an existing <div id="tree"> element
                                        // and pass the tree options as an argument to the dynatree() function:
                                        $("#jstree").dynatree({
                                            onActivate: function(node) {
                                                // A DynaTreeNode object is passed to the activation handler
                                                // Note: we also get this event, if persistence is on, and the page is reloaded.
                                            console.log("You activated " + node.data.key);
                                              //if (node.hasChildren() == true) 
                                                //alert('yay');
                                                //else{
                                                jQuery(document.getElementById("page1:form1:input1")).val( node.data.key);
                                                jQuery(document.getElementById("page1:form1:input2")).val( node.data.title);
                                                //alert(document.getElementById("page1:form1:input1").value);
                                                //alert(document.getElementById("page1:form1:input2").value);
                                                populateAccounts();
                                                //clearSearch();
                                                //}
                                            },
                                             clickFolderMode: 1,
                                            onPostInit:function(){
                                             var i = 0;
                                            $("#jstree").dynatree("getRoot").visit(function(node){
                                            if(i>1)
                                            
                                    node.expand(false);
                                    i++;
                                    });
                                   // this.activateKey('{!selectedPosition}');
                                   this.activateKey('{!activateDefault}');
                                     },
                                            persist: false,
                                            checkbox: {!selectable},
                                            generateIds: false,
                                            classNames: {
                                                checkbox: "dynatree-checkbox", 
                                                expanded: "dynatree-expanded"
                                            },
                                            selectMode: 3,
                                            children: {!JsonString},
                                            onSelect: function(select, node) {
                                                // Get a list of all selected nodes, and convert to a key array:
                                                var selKeys = $.map(node.tree.getSelectedNodes(), function(node){
                                                    return node.data.key;
                                                });
                                                jQuery(document.getElementById("{!$Component.input1}")).val(selKeys.join(", "));
                                                
                                                // Get a list of all selected TOP nodes
                                                var selRootNodes = node.tree.getSelectedNodes(true);
                                                // ... and convert to a key array:
                                                var selRootKeys = $.map(selRootNodes, function(node){
                                                    return node.data.key;
                                                });
                                            }
                                        });
                                         
                                    });
                                    
                 function refreshParent() {
                window.opener.location.reload();

                }
                
                </script> 
<div class=" box-main">
    <apex:actionStatus id="myStatus">
            <apex:facet name="start">
                <div>
                    <div class="popupBackground" ></div>
                    <div class="PopupPanel">
                        <table border="0" width="100%" height="100%">
                            <tr>
                                <td align="center"><b>Please Wait</b></td>
                            </tr>
                            <tr>
                                <td align="center"><img src="/img/loading.gif"/></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </apex:facet>
        </apex:actionStatus>
    <div class="box-top">
        <div class="box-top-div1" style="width:45%">{!$User.FirstName} {!$User.LastName}({!$Profile.Name})</div>
        <div class="box-top-div2">
            <apex:inputtext id="searchdata" value="{!searchStringG}" StyleClass="searchtxt1"   />
            <apex:commandButton value="Search"  styleClass="searchbutton1" reRender="thePbTable_1,GroupPaginationId,pnlRep" action="{!populateAccounts}" status="myStatus">
                <apex:param value="true" name="resetOffsetG" assignto="{!resetOffsetG}"/>
            </apex:commandButton>&nbsp;
            
            <apex:commandButton value="Clear" action="{!clearSearch}"  styleClass="button"  id="clearButtonId" rerender="searchdata,thePBasd,GroupPaginationId,pnlRep" />

            
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <apex:outputPanel id="GroupPaginationId">
                <apex:commandButton status="fetchStatus" reRender="thePBasd,GroupPaginationId" value="<<" action="{!firstG}" disabled="{!!hasPreviousG}" title="First Page"/>
                <apex:commandButton status="fetchStatus" reRender="thePBasd,GroupPaginationId" value="<" action="{!previousG}" disabled="{!!hasPreviousG}" title="Previous Page">
                    <apex:param value="false" name="resetOffsetG" assignto="{!resetOffsetG}"/>
                </apex:commandButton>
                <apex:commandButton status="fetchStatus" reRender="thePBasd,GroupPaginationId" value=">" action="{!nextG}" disabled="{!!hasNextG}" title="Next Page">
                    <apex:param value="false" name="resetOffsetG" assignto="{!resetOffsetG}"/>
                </apex:commandButton>
                <apex:commandButton status="fetchStatus" reRender="thePBasd,GroupPaginationId" value=">>" action="{!lastG}" disabled="{!!hasNextG}" title="Last Page">
                    <apex:param value="false" name="resetOffsetG" assignto="{!resetOffsetG}"/>
                </apex:commandButton>
                <apex:outputPanel ><apex:outputText >{!(pageNumberG * sizeG)+1-sizeG}-
                    {!IF((pageNumberG * sizeG)>noOfRecordsG, noOfRecordsG,(pageNumberG * sizeG))} of {!noOfRecordsG}</apex:outputText></apex:outputPanel>
                <apex:outputPanel style="font-weight:bold">
                    <apex:actionStatus id="fetchStatus" startText="Fetching..." stopText=""/>
                </apex:outputPanel>
            </apex:outputPanel>
            
        </div>
    </div>
    
    <div class="box-content">
        <div class="tree1">
            <div class="table_header_tree">Territory Organization </div>
            <div id="jstree" > </div>
        </div>
        <div class="tablecontent">
            <div class="axtria" ></div>
            <div>
                <apex:inputHidden id="input1"  value="{!selectedPosition}"/>
                <apex:inputHidden id="input2"  value="{!selectedLabel}"/>

                <apex:actionfunction rerender="thePBasd,pnlRep,thePbTable_2,GroupPaginationId" action="{!populateAccounts}" name="populateAccounts" status="myStatus"/>
                <apex:actionfunction action="{!dealersInDealerGrp}" reRender="msg,error,pnlRep,thePBasd,thePbTable_2,thePbTable_1" name="dealersInGroup" status="myStatus"/>
                <!--<apex:outputPanel id="dealerPanel">-->
                    <apex:pageBlock id="thePBasd" mode="maindetail" >
                        <apex:outputpanel id="mainTablePanel">
                        <apex:pageblockTable value="{!lstPosDisplay}" var="a" id="thePbTable_1"  styleClass="tablesorter"   onRowClick=""  headerClass="header">    
                        
                            <apex:column style="{!if(a.Account__r.Id==dealerParentId,'background-color:#DCEEF3;font-weight:bold','')};padding:0px;text-align:left;padding-left:15px;width:100px;cursor:pointer;')}" >
                                <apex:facet name="header">
                                    <apex:commandLink action="{!sortGroup}" rerender="thePbTable_1,GroupPaginationId,pnlRep" style="color:white;" status="load" value="Dealer Group ID {!IF(compareField=='ATC_Dealer_Id__c',IF(sortOrder='asc','▲','▼'),'')}">
                                        <apex:param name="compareField" value="ATC_Dealer_Id__c" assignTo="{!compareField}" />  
                                        <apex:param name="orderType" value="{!IF(sortOrder='asc', 'desc', 'asc')}" assignTo="{!sortOrder}" /> 
                                        <apex:param name="FieldType" value="String" assignTo="{!typeOfField}" />  
                                    </apex:commandLink>
                                </apex:facet>{!a['Account__r']['ATC_Dealer_Id__c']}
                            </apex:column>
                            
                            <apex:column style="{!if(a.Account__r.Id==dealerParentId,'background-color:#DCEEF3;font-weight:bold','')};padding:0px;text-align:left;padding-left:15px;width:100px;cursor:pointer;')}" >
                                <apex:facet name="header">
                                    <apex:commandLink action="{!sortGroup}" rerender="thePbTable_1,GroupPaginationId,pnlRep" style="color:white;" status="load" value="Dealer Group Name {!IF(compareField=='Name',IF(sortOrder='asc','▲','▼'),'')}">
                                        <apex:param name="orderType" value="{!IF(sortOrder='asc', 'desc', 'asc')}" assignTo="{!sortOrder}" /> 
                                        <apex:param value="Name" name="compareField" assignTo="{!compareField}" ></apex:param>
                                        <apex:param name="FieldType" value="String" assignTo="{!typeOfField}" />  
                                    </apex:commandLink>
                                </apex:facet>
                                <apex:actionSupport action="{!dealersInDealerGrp}" reRender="pnlRep,thePBasd,msg,error" event="onclick"  oncomplete="assignFunction();" status="myStatus">
                                    <apex:param value="{!a.Account__r.Name}" assignTo="{!dealerParent}" name="dealerParent"/>
                                    <apex:param value="{!a.Account__r.Id}" assignTo="{!dealerParentId}" name="dealerParentId"/>
                                    <apex:param value="true" name="resetOffsetD" assignto="{!resetOffsetD}"/>{!a.Account__r.Name} 
                                </apex:actionSupport>
                            </apex:column>
                            
                            
                            
                            <apex:column style="{!if(a.Account__r.Id==dealerParentId,'background-color:#DCEEF3;font-weight:bold','')};padding:0px;text-align:left;padding-left:15px;width:100px;cursor:pointer;')}" >
                                <apex:facet name="header">
                                    <apex:commandLink action="{!sortGroup}" rerender="thePbTable_1,GroupPaginationId,pnlRep" style="color:white;" status="load" value="# Rooftops {!IF(compareField=='dealercount__c',IF(sortOrder='asc','▲','▼'),'')}">
                                        <apex:param name="compareField" value="dealercount__c" assignTo="{!compareField}" />  
                                        <apex:param name="FieldType" value="Decimal" assignTo="{!typeOfField}" />  
                                        <apex:param name="orderType" value="{!IF(sortOrder='asc', 'desc', 'asc')}" assignTo="{!sortOrder}" /> 
                                    </apex:commandLink>
                                </apex:facet><apex:outputText value="{!a.Account__R.SalesIQ__dealercount__c}"/>
                            </apex:column>
                            
                            <apex:column style="{!if(a.Account__r.Id==dealerParentId,'background-color:#DCEEF3;font-weight:bold','')};padding:0px;text-align:left;padding-left:15px;width:100px;cursor:pointer;')}" >
                                <apex:facet name="header">
                                    <apex:commandLink action="{!sortGroup}" rerender="thePbTable_1,GroupPaginationId,pnlRep" style="color:white;" status="load" value="Billable {!IF(compareField=='billable__c',IF(sortOrder='asc','▲','▼'),'')}">
                                        <apex:param name="compareField" value="billable__c" assignTo="{!compareField}" />  
                                        <apex:param name="FieldType" value="Decimal" assignTo="{!typeOfField}" />  
                                        <apex:param name="orderType" value="{!IF(sortOrder='asc', 'desc', 'asc')}" assignTo="{!sortOrder}" /> 
                                    </apex:commandLink>
                                </apex:facet>
                                <apex:outputText value="${0, number, ###,##0}">
                                    <apex:param value="{!a.Account__r.SalesIQ__Total_Billable__c}"/>
                                </apex:outputText>
                            </apex:column>
                            
                            <apex:column style="{!if(a.Account__r.Id==dealerParentId,'background-color:#DCEEF3;font-weight:bold','')};padding:0px;text-align:left;padding-left:15px;width:100px;cursor:pointer;')}" >
                                <apex:facet name="header">
                                    <apex:commandLink action="{!sortGroup}" rerender="thePbTable_1,GroupPaginationId,pnlRep" style="color:white;" status="load" value="Opportunity {!IF(compareField=='Opportunity_Amount__c',IF(sortOrder='asc','▲','▼'),'')}">
                                        <apex:param name="compareField" value="Opportunity_Amount__c" assignTo="{!compareField}" />  
                                        <apex:param name="FieldType" value="Decimal" assignTo="{!typeOfField}" />  
                                        <apex:param name="orderType" value="{!IF(sortOrder='asc', 'desc', 'asc')}" assignTo="{!sortOrder}" /> 
                                    </apex:commandLink>
                                </apex:facet>{!a.Account__r.SalesIQ__Total_Opportunity__c}
                            </apex:column>
                            
                            
                        </apex:pageblockTable>    
                        </apex:outputpanel>                   
                    </apex:pageBlock>
          <!--      </apex:outputPanel>-->
            </div>
        </div>
    </div>
</div>

                
<apex:actionfunction name="search"   rerender="pb1" status="actStatusId" />
<apex:actionfunction name="processLinkFun" action="{!popuplink}" rerender="msg,Popup"/>
<apex:actionfunction name="processDelinkFun" action="{!popupdelink}" rerender="msg,Popup"/>
<apex:actionfunction name="linkError" action="{!linkError}" rerender="msg"/>  
<!--<apex:actionFunction name="callBeginning" action="{!Beginning}" rerender="pageNumId"/>-->
<apex:outputPanel id="msg"> <apex:pagemessages /></apex:outputPanel>        
                
<apex:outputpanel id="pnlRep"  >
    <apex:pageBlock id="pb1" mode="maindetail" title="{!dealerParent}" >                     
        <div class=" box-main">
            <div class="box-top">
                <apex:pageblockbuttons location="top">
                    
                    <apex:actionStatus id="actStatusId" >
                        <apex:facet name="start" >
                            <img src="/img/loading.gif" /> 
                        </apex:facet>
                    </apex:actionStatus>
                    <apex:inputtext value="{!searchDealer}" styleclass="searchtxt1"/>
                    <apex:commandbutton value="Search" action="{!searchReqDealer}" styleclass="searchbutton1" rerender="pnlRep,msg,myButtons,myButtonsD" status="myStatus">
                        <apex:param value="true" name="resetOffset" assignto="{!resetOffset}"/>
                    </apex:commandbutton>&nbsp;&nbsp;
                    <apex:commandButton value=" Link to Group " styleclass="searchbutton2" onclick="processLinkButton();return false;"  disabled="{!delinkDisable}"  rendered="{!if(dealerParent!=null&&renderLink==true,true,false)}"></apex:commandButton>
                    <apex:commandButton value="Delink" id="delinkButtonId"   onclick="processDelinkButton();return false;"  styleclass="searchbutton2"  rendered="{!if(dealerParent!=null&&renderLink==false,true,false)}"></apex:commandButton>
                    
                    <apex:outputpanel id="myButtons" style="float:right" rendered="{!Pagination='search'}" >
                         Page&nbsp;<apex:outputPanel id="pageNumId">{!PageNumber}</apex:outputPanel> of&nbsp;
                          <apex:outputPanel id="totalPagesId">{!TotalPages}</apex:outputPanel>&nbsp;
                        <apex:commandButton value="<<" action="{!Beginning}" rerender="thePbTable_2,myButtons,error,msg"  status="status" disabled="{!DisablePrevious}"/>
                        <apex:commandButton value="Previous" action="{!Previous}" rerender="thePbTable_2,myButtons,error,msg"  status="status" disabled="{!DisablePrevious}">
                            <apex:param value="false" name="resetOffset" assignto="{!resetOffset}"/>
                        </apex:commandButton>
                        <apex:commandButton value="Next" action="{!Next}" reRender="thePbTable_2,myButtons,error,msg" status="status" disabled="{!DisableNext}">
                            <apex:param value="false" name="resetOffset" assignto="{!resetOffset}"/>
                        </apex:commandButton>
                        <apex:commandButton value=">>" action="{!End}" rerender="thePbTable_2,myButtons,error,msg"  status="status" disabled="{!DisableNext}">
                            <apex:param value="false" name="resetOffset" assignto="{!resetOffset}"/>
                        </apex:commandButton>
                        <apex:actionStatus id="status" startText="Please Wait..."/>
                    </apex:outputpanel>
                    
                    <apex:outputpanel id="myButtonsD" style="float:right" rendered="{!Pagination='Dealers'}">
                         Page&nbsp;<apex:outputPanel id="pageNumIdD">{!PageNumberD}</apex:outputPanel> of&nbsp;
                          <apex:outputPanel id="totalPagesIdD">{!TotalPagesD}</apex:outputPanel>&nbsp;
                        <apex:commandButton value="<<" action="{!BeginningD}" rerender="thePbTable_2,myButtonsD,error,msg"  status="statusD" disabled="{!DisablePreviousD}"/>
                        <apex:commandButton value="Previous" action="{!PreviousD}" rerender="thePbTable_2,myButtonsD,error,msg"  status="statusD" disabled="{!DisablePreviousD}">
                            <apex:param value="false" name="resetOffsetD" assignto="{!resetOffsetD}"/>
                        </apex:commandButton>
                        <apex:commandButton value="Next" action="{!NextD}" reRender="thePbTable_2,myButtonsD,error,msg" status="statusD" disabled="{!DisableNextD}">
                            <apex:param value="false" name="resetOffsetD" assignto="{!resetOffsetD}"/>
                        </apex:commandButton>
                        <apex:commandButton value=">>" action="{!EndD}" rerender="thePbTable_2,myButtonsD,error,msg"  status="statusD" disabled="{!DisableNextD}">
                            <apex:param value="false" name="resetOffsetD" assignto="{!resetOffsetD}"/>
                        </apex:commandButton>
                        <apex:actionStatus id="statusD" startText="Please Wait..."/>
                    </apex:outputpanel>
                    
                </apex:pageblockbuttons>    
            </div>  
            <div class="box-content">  
                <apex:pageBlockTable value="{!wraplstPosAccount }" var="c" id="thePbTable_2" headerClass="table"  styleclass="tablesorter" rowClasses="one,two" >                    
                    <apex:pagemessages id="error"></apex:pagemessages>   
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};">
                        <apex:inputcheckbox value="{!c.isSelected}" rendered="{!c.enable1}"></apex:inputcheckbox>
                    </apex:column>
                    
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};">
                        <apex:facet name="header">
                            <apex:commandLink action="{!sortFunction}" rerender="thePbTable_2,myButtonsD,myButtons" style="color:white;" status="load" value="Dealer Name {!IF(sortExpression=='Name',IF(sortDirection='ASC','▲','▼'),'')}">
                                <apex:param value="Name" name="column" assignTo="{!sortExpression}" ></apex:param>
                            </apex:commandLink>
                        </apex:facet>{!c.acc.Name}
                    </apex:column>
                    
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};">
                        <apex:facet name="header">
                            <apex:commandLink action="{!sortFunction}" rerender="thePbTable_2,myButtonsD,myButtons" style="color:white;" status="load" value="Group {!IF(sortExpression=='Propose_Parent__r.Name',IF(sortDirection='ASC','▲','▼'),'')}">
                                <apex:param value="Propose_Parent__r.Name" name="column" assignTo="{!sortExpression}" ></apex:param>
                            </apex:commandLink>
                        </apex:facet>{!c.acc.Propose_parent__r.Name}
                    </apex:column>
                    
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};">
                        <apex:facet name="header">
                            <apex:commandLink action="{!sortFunction}" rerender="thePbTable_2,myButtonsD,myButtons" style="color:white;" status="load" value="ATC ID {!IF(sortExpression=='ATC_Dealer_Id__c',IF(sortDirection='ASC','▲','▼'),'')}">
                                <apex:param value="ATC_Dealer_Id__c" name="column" assignTo="{!sortExpression}" ></apex:param>
                            </apex:commandLink>
                        </apex:facet>{!c.acc['ATC_Dealer_Id__c']}
                    </apex:column>
                    
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};">
                        <apex:facet name="header">
                            <apex:commandLink action="{!sortFunction}" rerender="thePbTable_2,myButtonsD,myButtons" style="color:white;" status="load" value="Address {!IF(sortExpression=='ShippingStreet',IF(sortDirection='ASC','▲','▼'),'')}">
                                <apex:param value="ShippingStreet" name="column" assignTo="{!sortExpression}" ></apex:param>
                            </apex:commandLink>
                        </apex:facet>{!c.acc.shippingStreet }
                    </apex:column>
                    
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};">
                        <apex:facet name="header">
                            <apex:commandLink action="{!sortFunction}" rerender="thePbTable_2,myButtonsD" style="color:white;" status="load" value="City {!IF(sortExpression=='ShippingCity',IF(sortDirection='ASC','▲','▼'),'')}">
                                <apex:param value="ShippingCity" name="column" assignTo="{!sortExpression}" ></apex:param>
                            </apex:commandLink>
                        </apex:facet>{!c.acc.shippingCity }
                    </apex:column>
                    
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};" >
                        <apex:facet name="header">
                            <apex:commandLink action="{!sortFunction}" rerender="thePbTable_2,myButtonsD,myButtons" style="color:white;" status="load" value="State {!IF(sortExpression=='ShippingState',IF(sortDirection='ASC','▲','▼'),'')}">
                                <apex:param value="ShippingState" name="column" assignTo="{!sortExpression}" ></apex:param>
                            </apex:commandLink>
                        </apex:facet>{!c.acc.shippingState }
                    </apex:column>
                    
                    <apex:column headervalue="Territory ID" style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};">{!c.territory}</apex:column>
                    
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};" >
                        <apex:facet name="header">
                            <apex:commandLink action="{!sortFunction}" rerender="thePbTable_2,myButtonsD,myButtons" style="color:white;" status="load" value="Opportunity {!IF(sortExpression=='Opportunity_Amount__c',IF(sortDirection='ASC','▲','▼'),'')}">
                                <apex:param value="Opportunity_Amount__c" name="column" assignTo="{!sortExpression}" ></apex:param>
                            </apex:commandLink>
                        </apex:facet>{!c.acc['Opportunity_Amount__c']}
                    </apex:column>
                    
                    <apex:column style="{!IF(c.Acc.SalesIQ__Propose_parent__c!=c.Acc.ParentId,'background-color:lightgreen','')};" >
                        <apex:facet name="header">
                            <apex:commandLink action="{!sortFunction}" rerender="thePbTable_2,myButtonsD,myButtons" style="color:white;" status="load" value="Billable {!IF(sortExpression=='billable__c',IF(sortDirection='ASC','▲','▼'),'')}">
                                <apex:param value="billable__c" name="column" assignTo="{!sortExpression}" ></apex:param>
                            </apex:commandLink>
                        </apex:facet>
                        <apex:outputText value="${0, number, ###,##0}"><apex:param value="{!c.acc.SalesIQ__billable__c}"/></apex:outputText>
                    </apex:column>

<apex:actionStatus id="load" startText="Loading..."/>        
                    
                </apex:pageBlockTable>
            </div>
        </div>                        
    </apex:pageBlock>                      
</apex:outputpanel>       
                                
                        
                
                
<apex:outputPanel id="Popup" >
    <apex:outputPanel styleClass="popupBackground" layout="block"  rendered="{!displaypopup}"/>
    <apex:outputPanel styleclass="Popup2" layout="block" rendered="{!displaypopup }">  
        <div class="box-main-popup">  
            <div class="box-top">
                <div class="box-top-div1">{!linkDelink}</div>
            </div>                  
            <div class="box-content-popup">
                <table border="0" width="100%"  cellspacing="0px">
                    <tr >                    
                        <td  class="notes1">Group</td>
                        <td  style="height:25px;"><b>{!dealerParent}</b></td>
                    </tr>
                    
                    <tr >
                        <td class="notes1">Comment</td>
                        <td  > <apex:inputtextarea value="{!comment}" rows="3" styleclass="notes-textbox" /> </td>
                    </tr> 
                    <tr style="height:17px;">
                        <td colspan="3" style="text-align: center;">
                            <apex:commandButton value="Submit Delink" action="{!submitDelink}" rerender="Popup,thePBasd,pnlRep,error,msg" style="margin-right:5%;width:100px;background:#36647d;color:white; height:25px;" rendered="{!!renderLink}" status="myStatus" oncomplete="populateAccounts();"/>
                            <apex:commandButton value="Submit Link" action="{!link}" rerender="Popup,thePBasd,pnlRep,error,msg" style="margin-right:10%;width:80px;background:#36647d;color:white; height:25px;" rendered="{!renderLink}" status="myStatus"/> 
                            <apex:commandButton value="Cancel" style="margin-right:10%;width:80px;background:#36647d;color:white; height:25px;"  action="{!cancelDelink}" rerender="Popup" />   <br/><br/> 
                        </td>
                    </tr>                    
                </table> 
            </div> 
        </div>                  
    </apex:outputPanel>
</apex:outputPanel>   
                
</body>
</apex:form>
</apex:page>